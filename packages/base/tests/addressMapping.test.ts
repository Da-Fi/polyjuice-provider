import test from "ava";
import {
  L2TransactionWithAddressMapping,
  RawL2TransactionWithAddressMapping,
} from "../../godwoken/src/addressTypes";
import {
  serializeRawL2TransactionWithAddressMapping,
  serializeL2TransactionWithAddressMapping,
  deserializeRawL2TransactionWithAddressMapping,
  deserializeL2TransactionWithAddressMapping,
} from "../lib/index";

test.serial("serialize raw-l2-tx-with-address-mapping", (t) => {
  const data: RawL2TransactionWithAddressMapping = {
    raw_tx: {
      from_id: "0x14",
      to_id: "0x13",
      nonce: "0x16",
      args: "0x1024",
    },
    addresses: {
      length: "0x1",
      data: [
        {
          eth_address: "0xfb2c72d3ffe10ef7c9960272859a23d24db9e04a",
          gw_short_address: "0x24f1de0c7084a2fb17a205282a8cd046e9fff047",
        },
      ],
    },
    extra: "0x11",
  };
  const serializeData = serializeRawL2TransactionWithAddressMapping(data);
  const deserializeData =
    deserializeRawL2TransactionWithAddressMapping(serializeData);
  t.deepEqual(deserializeData, data);
});

test.serial("serialize l2-tx-with-address-mapping", (t) => {
  const data: L2TransactionWithAddressMapping = {
    tx: {
      raw: {
        from_id: "0x14",
        to_id: "0x13",
        nonce: "0x16",
        args: "0x1024",
      },
      signature:
        "0xfea265627a7a7231582001528e3c7dc7db53b0fea265627a7a7231582001528efea265627a7a7231582001528e3c7dc7db53b0fea265627a7a7231582001528e88",
    },
    addresses: {
      length: "0x1",
      data: [
        {
          eth_address: "0xfb2c72d3ffe10ef7c9960272859a23d24db9e04a",
          gw_short_address: "0x24f1de0c7084a2fb17a205282a8cd046e9fff047",
        },
      ],
    },
    extra: "0x11",
  };
  // const serializeData = "0xfd04000010000000e5040000f9040000d50400000c000000900400008404000014000000180000001c0000002000000004000000030000001600000060040000ffffff504f4c590320a107000000000000000000000000000000000000000000000000000000000000000000000000002c040000608060405234801561001057600080fd5b5061040c806100206000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c80632801617e146100515780636d4ce63c146100955780639f494991146100df578063d504ea1d14610197575b600080fd5b6100936004803603602081101561006757600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506101f6565b005b61009d610239565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b610195600480360360208110156100f557600080fd5b810190808035906020019064010000000081111561011257600080fd5b82018360208201111561012457600080fd5b8035906020019184602083028401116401000000008311171561014657600080fd5b919080806020026020016040519081016040528093929190818152602001838360200280828437600081840152601f19601f820116905080830192505050505050509192919290505050610262565b005b61019f61027c565b6040518080602001828103825283818151815260200191508051906020019060200280838360005b838110156101e25780820151818401526020810190506101c7565b505050509050019250505060405180910390f35b806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b806001908051906020019061027892919061030a565b5050565b6060600180548060200260200160405190810160405280929190818152602001828054801561030057602002820191906000526020600020905b8160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190600101908083116102b6575b5050505050905090565b828054828255906000526020600020908101928215610383579160200282015b828111156103825782518260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055509160200191906001019061032a565b5b5090506103909190610394565b5090565b6103d491905b808211156103d057600081816101000a81549073ffffffffffffffffffffffffffffffffffffffff02191690555060010161039a565b5090565b9056fea265627a7a72315820e5de101a155dd99887410de2703d538ff81a88530c31ad8aa76e88a527725ace64736f6c6343000510003241000000617945ce5a6cc40c80673129de786fb3a2fb9c7073ae3cb2bb2a4510affca55d4124a677879944ac2dc0eff1f52a6194c503e6331553dcf3d4186b2661c3272501140000000c00000010000000000000000400000000000000";
  const serializeData = serializeL2TransactionWithAddressMapping(data);
  const deserializeData =
    deserializeL2TransactionWithAddressMapping(serializeData);
  t.deepEqual(deserializeData, data);
});
